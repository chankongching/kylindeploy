<?php
	$databases['default']['default'] = array (
		'driver' => 'autoslave',
		'master' => array('master', 'autoslave'), // Fallback to slaves if master fails (read-only mode)
		'slave' => array('autoslave', 'master'), // Fallback to master if slaves fail
		'affected tables backend' => 'autoslave.affected_tables.memcache-db-accurate.inc',
		'watchdog on shutdown' => TRUE,
		'replication lag' => 2,
	);
	$databases['default']['master'] = array (
		'database' => '<%= node[:autoslaveex][:dbname] %>',
		'username' => '<%= node[:autoslaveex][:dbuser] %>',
		'password' => '<%= node[:autoslaveex][:dbpwd] %>',
		'host' => '<%= node[:autoslaveex][:masterhost] %>',
		'port' => '<%= node[:autoslaveex][:port] %>',
		'driver' => 'mysql',
		'prefix' => '',
	);
	$databases['default']['autoslave'] = array (
		'database' => '<%= node[:autoslaveex][:dbname] %>',
		'username' => '<%= node[:autoslaveex][:dbuser] %>',
		'password' => '<%= node[:autoslaveex][:dbpwd] %>',
		'host' => '<%= node[:autoslaveex][:masterhost] %>',
		'port' => '<%= node[:autoslaveex][:port] %>',
		'driver' => 'mysql',
		'prefix' => '',
		'readonly' => TRUE, // Required for system to enter "readonly" mode if master fails.
		'tables' => array('sessions', 'semaphore', 'watchdog', 'users', 'history'),
);
// Use locking that supports force master
	$conf['lock_inc'] = '<%= node[:autoslaveex][:lockinc] %>';
// Use AutoSlave transactional safe cache wrapper with a memcache backend
	$conf['cache_backends'][] = '<%= node[:autoslaveex][:cachebackends] %>';
	$conf['cache_default_class'] = 'AutoslaveCache';
	$conf['autoslave_cache_default_class'] = 'MemCacheDrupal';
?>
